---
import type { WebSale } from '../types/WebSale';
---

<form id="newSaleForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="clientName">
            Nombre del Cliente
        </label>
        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="clientName" name="clientName" type="text" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="websiteUrl">
            URL del Sitio Web
        </label>
        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="websiteUrl" name="websiteUrl" type="url" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="amount">
            Monto
        </label>
        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="amount" name="amount" type="number" step="0.01" required>
    </div>
    <div class="mb-6">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="saleDate">
            Fecha de Venta
        </label>
        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="saleDate" name="saleDate" type="date" required>
    </div>
    <div class="flex items-center justify-between">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
            Registrar Venta
        </button>
    </div>
</form>

<script>
    import type { WebSale } from '../types/WebSale';

    const form = document.getElementById('newSaleForm') as HTMLFormElement;
    form.addEventListener('submit', async (e: Event) => {
        e.preventDefault();
        const formData = new FormData(form);
        const saleData: WebSale = {
            clientName: formData.get('clientName') as string,
            websiteUrl: formData.get('websiteUrl') as string,
            amount: parseFloat(formData.get('amount') as string),
            saleDate: formData.get('saleDate') as string
        };
        
        try {
            const response = await fetch('/api/websales', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(saleData),
            });
            
            if (response.ok) {
                alert('Venta registrada con Ã©xito');
                window.location.reload();
            } else {
                const errorData = await response.json();
                alert(`Error al registrar la venta: ${errorData.message || 'Desconocido'}`);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error al conectar con el servidor');
        }
    });
</script>